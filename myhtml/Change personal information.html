<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>개인정보 변경</title>
<style>
  :root{
    --bg:#ffffff; --ink:#111827; --sub:#6b7280; --line:#e5e7eb;
    --blue:#2563eb; --blue-700:#1e40af; --green:#16a34a; --red:#dc2626;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui, -apple-system, "Noto Sans KR", "Segoe UI", Roboto, sans-serif; background:var(--bg); color:var(--ink)}
  .wrap{max-width:960px; margin:40px auto; padding:0 20px}
  header{display:flex; align-items:center; justify-content:space-between; margin-bottom:32px;}
  .card{max-width:480px; margin:0 auto;}
  h1{font-size:22px; text-align:center; margin:24px 0 20px}
  .field{margin-bottom:16px}
  label{display:block; font-size:14px; color:var(--sub); margin-bottom:8px}
  input, select{width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:10px; font-size:14px; outline:none; background:#fff}
  input:focus, select:focus{border-color:var(--blue); box-shadow:0 0 0 3px rgba(37,99,235,.12)}
  input[readonly]{background:#f8fafc; color:#64748b}
  .help{font-size:12px; color:var(--sub); margin-top:6px}
  .err{font-size:12px; color:var(--red); margin-top:6px; display:none}
  .btn{width:100%; padding:13px 16px; border:none; border-radius:10px; background:var(--blue); color:#fff; font-weight:700; font-size:15px; cursor:pointer}
  .btn:hover{background:#1f4fe0}
  .note{display:none; margin-top:14px; font-size:13px; padding:10px 12px; border-radius:10px}
  .note.ok{background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0}
  .note.ng{background:#fef2f2; color:#7f1d1d; border:1px solid #fecaca}
  footer{margin-top:56px; padding:24px 0 8px; border-top:1px solid var(--line); color:var(--sub); font-size:12px}
  @media (max-width:520px){
    .wrap{margin:24px auto}
    h1{font-size:20px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header aria-label="페이지 헤더">
      <div style="font-weight:800;">QMU 찾아요!</div>
      <nav aria-label="바로가기">
        <a href="#" style="font-size:14px; color:var(--sub); text-decoration:none; margin-right:12px;">마이페이지</a>
        <a href="#" style="font-size:14px; color:#111; text-decoration:none;">로그아웃</a>
      </nav>
    </header>

    <main class="card" role="main">
      <h1>개인정보 변경</h1>
      <form id="profileForm" novalidate>
        <div class="field">
          <label for="name">이름</label>
          <input id="name" name="name" type="text" placeholder="이름을 입력하세요" required />
          <p class="err" id="err-name">이름을 입력해 주세요.</p>
        </div>

        <div class="field">
          <label for="uid">아이디</label>
          <input id="uid" name="uid" type="text" value="hyJ655" readonly aria-readonly="true" />
          <p class="help">아이디는 변경할 수 없습니다.</p>
        </div>

        <div class="field">
          <label for="phone">전화번호</label>
          <input id="phone" name="phone" type="tel" inputmode="numeric" placeholder="010-1234-5678" maxlength="13" />
          <p class="err" id="err-phone">전화번호 형식이 올바르지 않습니다. 예) 010-1234-5678</p>
        </div>

        <div class="field">
          <label for="dept">학과</label>
          <input id="dept" name="dept" type="text" placeholder="예: 항공운항학과" />
        </div>

        <div class="field">
          <label for="sid">학번</label>
          <input id="sid" name="sid" type="text" inputmode="numeric" placeholder="8자리 숫자" maxlength="8" />
          <p class="err" id="err-sid">학번은 8자리 숫자여야 합니다.</p>
        </div>

        <button type="submit" class="btn" aria-label="수정 완료">수정 완료</button>
        <div id="note-ok" class="note ok" role="status">개인정보가 성공적으로 수정되었습니다. 잠시 후 마이페이지로 이동합니다.</div>
        <div id="note-ng" class="note ng" role="alert">입력값을 확인해 주세요.</div>
      </form>
    </main>

    <footer>
      <div>동양미래대학교 분실물 찾기 서비스 · 문의: hjw57999@gmail.com</div>
    </footer>
  </div>

<script>
  // 전화번호 자동 포맷: 010-1234-5678
  const phone = document.getElementById('phone');
  phone.addEventListener('input', (e)=>{
    let v = e.target.value.replace(/[^\d]/g,'').slice(0,11); // 최대 11자리
    if(v.length >= 3 && v.length <= 7){ v = v.replace(/(\d{3})(\d+)/, '$1-$2'); }
    else if(v.length > 7){ v = v.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3'); }
    e.target.value = v;
  });

  function show(el, on){ el.style.display = on ? 'block' : 'none'; }

  const form = document.getElementById('profileForm');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    // 초기화
    ['err-name','err-phone','err-sid'].forEach(id=>show(document.getElementById(id), false));
    show(document.getElementById('note-ok'), false);
    show(document.getElementById('note-ng'), false);

    // 값 수집
    const name = document.getElementById('name').value.trim();
    const uid  = document.getElementById('uid').value.trim();
    const phoneVal = phone.value.trim();
    const dept = document.getElementById('dept').value.trim();
    const sid  = document.getElementById('sid').value.trim();

    // 검증
    let valid = true;
    if(!name){ show(document.getElementById('err-name'), true); valid = false; }

    const phoneOk = !phoneVal || /^010-\d{4}-\d{4}$/.test(phoneVal);
    if(!phoneOk){ show(document.getElementById('err-phone'), true); valid = false; }

    const sidOk = !sid || /^\d{8}$/.test(sid);
    if(!sidOk){ show(document.getElementById('err-sid'), true); valid = false; }

    if(!valid){ show(document.getElementById('note-ng'), true); return; }

    // 서버 전송 (샘플) — 실제 API 엔드포인트로 교체
    try{
      // const res = await fetch('/api/user/profile', {method:'PATCH', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name, phone:phoneVal, dept, sid})});
      // if(!res.ok) throw new Error('서버 오류');
      // 성공 UI
      show(document.getElementById('note-ok'), true);
      setTimeout(()=>{ window.location.href = '/mypage'; }, 1500);
    }catch(err){
      document.getElementById('note-ng').textContent = '서버 통신 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.';
      show(document.getElementById('note-ng'), true);
    }
  });
</script>
</body>
</html>
